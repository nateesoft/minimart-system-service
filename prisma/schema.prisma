generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  schemas  = ["minimart"]
}

// ============================================
// CATEGORY - หมวดหมู่สินค้า
// ============================================
model Category {
  id          Int       @id @default(autoincrement())
  slug        String    @unique
  name        String    @unique
  description String?
  icon        String?
  color       String?
  sortOrder   Int       @default(0)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]

  @@schema("minimart")
}

// ============================================
// PRODUCT - สินค้า
// ============================================
model Product {
  id               Int               @id @default(autoincrement())
  name             String
  categoryId       Int
  price            Float             @default(0)
  costPrice        Float             @default(0)
  barcode          String            @unique
  stock            Int               @default(0)
  minStock         Int               @default(10)
  image            String?
  unit             String
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  category         Category          @relation(fields: [categoryId], references: [id])
  transactionItems TransactionItem[]

  @@schema("minimart")
}

// ============================================
// TRANSACTION - รายการขาย
// ============================================
model Transaction {
  id            Int               @id @default(autoincrement())
  transactionId String            @unique
  subtotal      Float             @default(0)
  discount      Float             @default(0)
  total         Float             @default(0)
  status        TransactionStatus @default(COMPLETED)
  cashierName   String?
  cashierId     Int?
  notes         String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  items         TransactionItem[]
  payment       Payment?

  @@schema("minimart")
}

// ============================================
// TRANSACTION ITEM - รายการสินค้าในใบเสร็จ
// ============================================
model TransactionItem {
  id             Int         @id @default(autoincrement())
  transactionId  Int
  productId      Int
  productName    String
  productBarcode String
  quantity       Int
  unitPrice      Float
  totalPrice     Float
  createdAt      DateTime    @default(now())
  transaction    Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  product        Product     @relation(fields: [productId], references: [id])

  @@schema("minimart")
}

// ============================================
// PAYMENT - การชำระเงิน
// ============================================
model Payment {
  id            Int           @id @default(autoincrement())
  transactionId Int           @unique
  method        PaymentMethod
  amount        Float
  change        Float         @default(0)
  createdAt     DateTime      @default(now())
  transaction   Transaction   @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@schema("minimart")
}

// ============================================
// DAILY SALES - ยอดขายรายวัน (aggregated)
// ============================================
model DailySales {
  id                Int      @id @default(autoincrement())
  date              DateTime @unique @db.Date
  totalTransactions Int      @default(0)
  totalRevenue      Float    @default(0)
  totalItems        Int      @default(0)
  totalDiscount     Float    @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@schema("minimart")
}

// ============================================
// ENUMS
// ============================================
enum PaymentMethod {
  CASH
  CARD
  QR

  @@schema("minimart")
}

enum TransactionStatus {
  COMPLETED
  VOIDED
  REFUNDED

  @@schema("minimart")
}
